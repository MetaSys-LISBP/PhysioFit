Usage
=====

Required input data file
------------------------

The input data must be a tabulated file (.tsv extension) to be imported into the application. The structure of
the file is as follows:

==== ===== ======
Time   X    Met1
==== ===== ======
 1    0.2     x
 2    0.3     x
 3    0.4     x
etc   ...    ...
==== ===== ======

The time and biomass (X) columns are mandatory, as is at least one metabolite column. If the biomass and metabolite
concentrations were sampled at different moments, you can still group them together in the same table.

.. note:: Flux units depend on the units of time and concentrations (biomass and metabolites) provided in the input
             data file. For instance, if biomass units are in gDW/L, metabolite concentrations are in mM and time is
             in hours, the estimated fluxes will be in mmol/gDW/h. It is critical to correctly define the  units in the
             input file.

.. warning:: To limit any numerical instabilities, use values in a range not too far from unity (e.g. if a metabolite
             concentration is 2 µM, provide the value directly in µM and not as 2.10e-6 M). Each metabolite concentration can
             be given in different units as long as one unit is provided per metabolite.

The json config file
---------------------

The json config file presents an organisation similar to a python dictionary. You can find an example of one `here
<https://github.com/MetaSys-LISBP/PhysioFit/blob/dev_v2.0/config_example_file.json>`_.

For a description of each parameter, check the section below.

.. _PhysioFit parameters:

Processing parameters
--------------------

Here is a list of the different parameters that can be modified when setting up your run:

    * **Basic parameters:**
        - *Lag*: consider (or not) a lag phase (i.e. without growth) during flux calculation
        - *Degradation*: (first-order) degradation constants to be used during flux calculation (constants should be given as a
          python dictionary).
        - *Sensitivity analysis (Monte Carlo)*: Should the sensitivity analysis be performed on estimated parameters (if
          true then input the number of iterations). A higher number of iterations will give more accurate confidence
          intervals on the estimated parameters, but will make the run take longer to complete. The default number of
          iterations is 100 which is sufficient in most situations.

    * **Advanced parameters:**
        - *vini*: Initial value for parameters to estimate. This will be the starting point for the optimization. An
          initial value in a physiological range will ensure a quality fit. Default: 0.2
        - *Weights*: Standard deviation to apply during cost calculation (see eq. 10 in :doc:`method`). A higher weight
          will augment the weighted parameter's precision during the optimization, which might lower the
          precision on other parameters. A lower weight will give weighted parameter less precision, and might
          augment the precision on the other parameters. Defaults: 0.2 for biomass parameters, and 0.5 for metabolite
          parameters.
        - *Metabolite concentration bounds*: Bounds to apply to the metabolite concentrations during optimization to
          reduce the range of possibilities. Well-defined bounds will ensure that the values tested during the
          optimization process are closer to physiological values, which can reduce inconsistencies in the process. The
          default bounds are sufficient in most cases. Default: [1e-06, 50]
        - *Flux bounds*: Bounds to apply on fluxes during optimization to reduce the range of possibilities. Default:
          [-50, 50]
        - *Biomass initial concentration bounds*: Bounds to apply on the starting concentration for biomass to reduce
          the range of possibilities. Well-defined bounds will ensure that the values tested during the optimization
          process are closer to physiological values, which can reduce inconsistencies in the process. The default
          bounds are sufficient in most cases. Default: [1e-06, 50]
        - *Growth rate bounds*: Bounds to apply on the growth rate to reduce the range of possibilities. Well-defined bounds
          will ensure that the values tested during the optimization process are closer to physiological values, which
          can reduce inconsistencies in the process. The default bounds are sufficient in most cases. Default: [-50, 50]
        - *Verbose logs*: Should debug information be written in log file. Useful in case of trouble (please join it to the issue on github). Default: False

.. note:: For the different bounds to apply during flux calculation, the user must remember to make sure that the input
          data is inside them or else they run the risk of an error being thrown at them.

Result files & fit quality
---------------------------

The following files are generated by PhysioFit 2.0:

    * **config_file.json:** This is the config file containing all parameters used for the last run.
    * **Optimized_parameter_statistics.csv:** Calculation results (optimal parameters and associated statistics).
    * **log.txt:** The run log containing information on how the run went.
    * **plots.pdf:** pdf file containing plots of simulated and measured data.
    * **A number of .svg files containing the individual plots**

It is important to check the quality of your fit before interpreting the estimated fluxes. To evaluate the fit quality, you can check the log
file which contains at the end the khi² statistical test results. The generated plots show how accurately the simulated data fits the
experimental data points. Finally, the confidence intervals generated by the Monte-Carlo will provide quantitative information on the precision of the estimated parameters.
